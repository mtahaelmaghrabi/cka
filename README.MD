
# Kubernetes Cluster Setup Guide

This guide provides detailed instructions on how to set up a Kubernetes cluster using the scripts stored in the `cka` repository. Follow the steps below to configure both master and worker nodes in your cluster.

## Prerequisites
- You need a set of machines (virtual or physical) that will serve as the master and worker nodes.
- These machines should have Ubuntu installed and network connectivity between them.

## Repository Clone
First, clone the repository to each node in your cluster. This repository contains essential scripts for setting up Kubernetes.

```bash
git clone https://github.com/mtahaelmaghrabi/cka
```

## Common Setup for All Nodes
Perform these steps on both your master and worker nodes.

### Update System Packages
Ensure that all your system packages are up-to-date.

```bash
sudo apt update
```

### Setup Container Runtime
Run the container setup script to install Docker or any container runtime required by Kubernetes.

```bash
sudo cka/setup-container.sh
```

### Install Kubernetes Tools
Execute the Kubernetes tools setup script to install `kubeadm`, `kubelet`, and `kubectl`.

```bash
sudo cka/setup-kubetools.sh
```

## Master Node Setup
These steps should only be performed on the master node.

### Initialize Kubernetes Cluster
Initialize the cluster by running `kubeadm init`. This step will generate tokens and other important configurations.

```bash
sudo kubeadm init
```

### Configure Kubectl
Set up the kubeconfig file for accessing the Kubernetes cluster API.

```bash
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

### Install Networking Plugin
Apply the Calico CNI plugin to enable pod networking. You can replace Calico with any other CNI provider if needed.

```bash
kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.3/manifests/calico.yaml
```

To get the latest release of Calico, visit the [Calico GitHub releases page](https://github.com/projectcalico/calico/releases).

## Worker Nodes Setup
These steps are only for the worker nodes.

### Join Cluster
Use the token and discovery token CA cert hash generated by `kubeadm init` on the master to join each worker node to the cluster.

```bash
kubeadm join 192.168.100.95:6443 --token 2xvr1j.v5iob57u3ktf6w5p --discovery-token-ca-cert-hash sha256:9e42aab7e7d53f4cd062da3d34006e0ea95ab8a3a463b697bd4d930af8cc4d50
```

## Verification
After setting up the master and all worker nodes, verify that all nodes are connected and operational by running:

```bash
kubectl get nodes
```

This command should list all the nodes with their status as "Ready".

## Conclusion
You have successfully set up a Kubernetes cluster. This cluster is now ready to deploy applications. For further configuration and management, refer to the Kubernetes documentation.
